---
title: "7.1 Tasks: Prometheus Operator basics"
weight: 1
sectionnumber: 7
---

### Task 1

* Make sure that Prometheus and Alertmanager persist their data
* See this [example](https://github.com/prometheus-operator/prometheus-operator/blob/master/Documentation/user-guides/storage.md#manual-storage-provisioning) of how to configure memory for Prometheus
* Prometheus volume size: `10Gi`
* Alertmanager volume size `1Gi`

{{% alert title="Hint" color="primary" %}}
To get the custom resources name of your Alertmanager or Prometheus run:

`kubectl -n monitoring get prometheuses`

`kubectl -n monitoring get alertmanagers`

Custom resources can be changed by using `kubectl -n monitoring edit "type" "name"`.

If you want to edit the Prometheus custom resource you would use `kubectl -n monitoring edit prometheuses k8s`

{{% /alert %}}

### Task 2

* Set retention time to one day and retention size to 9Gi
* Read about [retention operational-aspects](https://prometheus.io/docs/prometheus/latest/storage/#operational-aspects)

### Task 3

* Configure Alertmanger to send all alerts to Mailcatcher

### Task 4

* Ensure that the Prometheus operator observes ServiceMonitors, PrometheusRules, and PodMonitors in all namespaces
* Use the following parameters in your Prometheus custom resource

```yaml
  podMonitorNamespaceSelector: {}
  podMonitorSelector: {}
  probeNamespaceSelector: {}
```

{{% alert title="Hint" color="primary" %}}
Check the [documentation](https://github.com/prometheus-operator/prometheus-operator/blob/master/Documentation/design.md#servicemonitor)
{{% /alert %}}

### Task 5 (optional)

* Alertmanager runs as HA setup
* Find out if they are clustered

## Solutions

{{% details title="Task 1" %}}

```bash
kubectl -n monitoring edit prometheuses k8s
...
  storage:
    volumeClaimTemplate:
      spec:
        resources:
          requests:
            storage: 10Gi
...
```

```bash
kubectl -n monitoring edit alertmanagers main
...
  storage:
    volumeClaimTemplate:
      spec:
        resources:
          requests:
            storage: 1Gi
...
```

```bash
kubectl -n monitoring get pvc
```

{{% /details %}}

{{% details title="Task 2" %}}

{{% /details %}}

{{% details title="Task 3" %}}

{{% /details %}}

{{% details title="Task 4" %}}

{{% /details %}}

{{% details title="Task 5" %}}

{{% /details %}}
