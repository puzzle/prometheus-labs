---
title: "4.2 Tasks: Pushgateway"
weight: 2
sectionnumber: 4.2
---

### Task {{% param sectionnumber %}}.1 - Install and configure Pushgwateway

First we will add the pre-installed Pushgetway to our Prometheus instance, later we will use our Pushgateway to add metrics and learn how to remove pushed metrics from the Pushgateway.

**Task description**: Configure Prometheus to scrape the metrics from the Pushgateway

{{% details title="Hints" mode-switcher="normalexpertmode" %}}

Extend the Prometheus `/etc/prometheus/prometheus.yml` as you would to add a common exporter.

```yaml
scrape_configs:
  - job_name: 'pushgateway'
    honor_labels: true
    static_configs:
    - targets:
      - 'localhost:9091'
```

Reload Prometheus to make changes active

```bash
sudo systemctl reload prometheus
```

You should now see the default metrics exposed by the Pushgetway with the following query:

```promql
{job="pushgateway"}
```

You can also directly navigate to your [Prometheus instance](http://LOCALHOST:9090/graph?g0.range_input=1h&g0.expr={job%3D"pushgateway"}&g0.tab=1)

{{% /details %}}

### Task {{% param sectionnumber %}}.2 - Push metrics to Pushgateway

**Task description**: [Push](https://github.com/prometheus/pushgateway/blob/master/README.md#command-line) the following metric to the Pushgateway and make sure the metric gets scraped by Prometheus

{{% alert title="Note" color="primary" %}}

If you see the labels `exported_instance` and `exported_job` in the Prometheus expression browser you did not set `honor_labels: true` in the Pushgateway scrape configuration.
{{% /alert %}}

```promql
# TYPE some_metric_total counter
# HELP This is just an example metric.
some_metric_total{job="prometheus_training",instance="myinstance"} 42
```

{{% details title="Hints" mode-switcher="normalexpertmode" %}}

```bash
cat <<EOF | curl --data-binary @- http://localhost:9091/metrics/job/pushgw/instance/example_instance
# TYPE some_metric_total counter
# HELP This is just an example metric.
some_metric_total 42
EOF
```

Verify the metric in the [Prometheus we UI](http://LOCALHOST:9090/graph?g0.range_input=1h&g0.expr=some_metric_total&g0.tab=1). It may take up to 30s ( Depending on the `scrape_interval`) to be available in Prometheus.

{{% /details %}}

### Task {{% param sectionnumber %}}.3 - Delete Pushgateway metrics

**Task description**: [Delete](https://github.com/prometheus/pushgateway/blob/master/README.md#command-line) all metrics from the Pushgateway

{{% alert title="Note" color="primary" %}}
Metrics pushed to the Pushgateway are not automatically purged until you manually delete them via the API or the process restarts. If you persist the metrics with `--persistence.file`, you should ensure that you have set up a job that cleans up the metrics on a regular basis.
{{% /alert %}}

{{% details title="Hints" mode-switcher="normalexpertmode" %}}

Deleting metrics requires the cli option `--web.enable-admin-api`, which we have enabled for you, but which is disabled by default.

```bash
curl -X PUT http://localhost:9091/api/v1/admin/wipe
```

It is also possible to delete only metrics with specific job or instance labels. Please refer to the [upstream documentation](https://github.com/prometheus/pushgateway) for more examples.

{{% /details %}}
