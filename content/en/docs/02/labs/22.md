---
title: "2.1 Prometheus Basics Training - Metrics PromQL"
weight: 2
sectionnumber: 2
---

### Task 1

* Show the total of all samples scraped by prometheus

### Task 2

* Display the current CPU Usage of the Prometheus Server in %

Hint: Read [documentation](https://prometheus.io/docs/prometheus/latest/querying/functions/) about the rate() function

### Task 3 (Advanced)

* FIXME: join labels

Disk {{ $labels.device }} (mountpoint {{ $labels.mountpoint }}) on node {{ $labels.instance }} will be full in 4 hours.
(node_filesystem_size_bytes{instance=~"build-runner0.*|jenkins.*"} / 1024 ^ 3 > 5) and (predict_linear(node_filesystem_avail_bytes{instance=~"build-runner0.*|jenkins.*"}[1d12h], 3600 * 4) < 0)

### Task 4 (Advanced)

* FIXME: join labels

## Solutions

<details><summary>Task 1</summary>

<http://127.0.0.1:9090/graph?g0.range_input=1h&g0.expr=sum(scrape_samples_scraped)>
```
sum(scrape_samples_scraped)
```

</details>

<details><summary>Task 2</summary>

<http://127.0.0.1:9090/graph?g0.range_input=1m&g0.expr=100%20-%20(avg%20by%20(instance)%20(irate(node_cpu_seconds_total%7Bmode%3D%22idle%22%7D%5B5m%5D))%20*%20100)>
```
100 - (avg by (instance) (irate(node_cpu_seconds_total{job="node",mode="idle"}[5m])) * 100)
```

</details>

<details><summary>Task 3</summary>

</details>
